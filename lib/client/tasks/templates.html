<template name="tasksList">
    <ul>
        {{#if tasks}}
            {{#each tasks}}
                <li>{{> task}}</li>
            {{/each}}
        {{/if}}
    </ul>
</template>

<template name="task">
    {{# if selectedTask}}
        {{> editTaskForm model=this parent=parent doc=doc docType=docType }}
    {{else}}
        <h4>{{title}}<span><small> - {{createdAt}}</small></span></h4>
        <p>{{description}}</p>
        {{#if addTask}}
            {{> insertTaskForm }}
        {{else}}
            <button class="addTask">Add Task</button>
        {{/if}}
        {{#if addSubTask}}
            {{> insertSubTask parent=_id doc=doc docType=docType }}
        {{else}}
            <button class="addSubTask">Add Subtask</button>
        {{/if}}
        <button class="editTask">Edit</button>
        <small><button class="deleteTask">Delete</button></small>

        {{#if subTasks}}
            <ul>
                {{#each subTasks}}
                    <li>{{> task}}</li>
                {{/each}}
            </ul>
        {{/if}}
    {{/ if}}
</template>

<template name="insertTaskForm">
    {{#autoForm collection="Tasks" meteormethod="newTask" type="insert" id="insertTaskForm"}}
        {{> afQuickField name='title'}}
        {{> afQuickField name='parent' value=parent type='hidden'}}
        {{> afQuickField name='doc' value=doc type='hidden'}}
        {{> afQuickField name='docType' value=docType type='hidden'}}
        {{> afQuickField name='category' value=category type='hidden'}}
        <button id="submitTaskForm" type="submit" class="btn btn-primary">Add Task</button>
    {{/autoForm}}
</template>

<template name="insertSubTask">
    {{> insertTaskForm parent=parent doc=doc docType=docType}}
</template>

<template name="editTaskForm">
    {{#autoForm collection="Tasks" doc=model meteormethod="updateTask" type="update" id="editTaskForm"}}
        {{> afQuickField name='title'}}
        {{> afQuickField name='description' rows=6 }}
        {{> afQuickField name='category' options=taskCategories }}
        {{> afQuickField name='startDate' }}
        {{> afQuickField name='stopDate' }}
        {{> afQuickField name='estimatedTimeToComplete' }}
        {{> afQuickField name='incomingTasks' options=incomingTasks }}
        {{> afQuickField name='outgoingTasks' options=outgoingTasks }}
        {{> afQuickField name='parent' value=parent type='hidden'}}
        {{> afQuickField name='doc' value=doc type='hidden'}}
        {{> afQuickField name='docType' value=docType type='hidden'}}
        <button id="submitUpdate" type="submit">Update</button>
        <button id="cancelUpdate" type="submit">Cancel</button>
    {{/autoForm}}
</template>
