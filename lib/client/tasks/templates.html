<template name="tasksList">
    <ul>
        {{#if tasks}}
            {{#each tasks}}
                <li>{{> task}}</li>
            {{/each}}
        {{/if}}
    </ul>
</template>

<template name="task">
    {{#if editTask}}
        {{> editTaskForm model=this parent=parent doc=doc docType=docType }}
    {{else}}
       {{#if selectedTask}}
           {{> showtask}}
       {{else}}
           <a href="#" class="selectTask">
                <h4>{{title}}<span><small> - {{createdAt}}</small></span></h4>
           </a>
       {{/if}}
        {{#if addTask}}
            {{> insertTaskForm }}
        {{else}}
            {{> button_icon_only class="addTask tiny" _id=_id content=addTaskText icon="plus"}}
        {{/if}}
        {{#if addSubTask}}
            {{> insertSubTask parent=_id doc=doc docType=docType }}
        {{else}}
            {{> button class="addSubTask tiny" text=addSubTaskText _id=_id}}
        {{/if}}
        {{> membershipButton collection='Tasks' _id=_id buttontext='applyForTask' }}
        {{> button_icon_only class="editTask tiny" _id=_id content=editTaskText icon="edit"}}
        {{> button_icon_only class="deleteTask red tiny" _id=_id content=deleteTaskText icon="delete"}}

        {{#if subTasks}}
            <ul>
                {{#each subTasks}}
                    <li>{{> task}}</li>
                {{/each}}
            </ul>
        {{/if}}
    {{/ if}}
</template>

<template name="showtask">
    <h4>{{title}}</h4>
    <small> - {{createdAt}}</small>
    <p>{{description}}</p>
    <p>{{startDate}}</p>
    <p>{{stopDate}}</p>
    <p>{{estimatedTimeToComplete}}</p>
    <p>{{publicity}}</p>
</template>

<template name="insertTaskForm">
    {{#autoForm collection="Tasks" meteormethod="newTask" type="insert" id="insertTaskForm"}}
        {{> afQuickField name='title'}}
        {{> afQuickField name='parent' value=parent type='hidden'}}
        {{> afQuickField name='doc' value=doc type='hidden'}}
        {{> afQuickField name='docType' value=docType type='hidden'}}
        {{> afQuickField name='category' value=category type='hidden'}}
        {{> button_with_icon class="tiny" id="submitTaskForm" icon="plus" type="submit" text=addTaskText}}
    {{/autoForm}}
</template>

<template name="insertSubTask">
    {{> insertTaskForm parent=parent doc=doc docType=docType}}
</template>

<template name="editTaskForm">
    {{#autoForm collection="Tasks" doc=model meteormethod="updateTask" type="update" id="editTaskForm"}}
        {{> afQuickField name='title'}}
        {{> afQuickField name='description' rows=6 }}
        {{> afQuickField name='category' options=taskCategories }}
        {{> afQuickField name='startDate' }}
        {{> afQuickField name='stopDate' }}
        {{> afQuickField name='estimatedTimeToComplete' }}
        {{> afQuickField name='publicity' }}
        {{#if incomingTasks}}
            {{> afQuickField name='incomingTasks' options=incomingTasks }}
        {{/if}}
        {{#if outgoingTasks}}
            {{> afQuickField name='outgoingTasks' options=outgoingTasks }}
        {{/if}}
        {{> afQuickField name='parent' value=parent type='hidden'}}
        {{> afQuickField name='doc' value=doc type='hidden'}}
        {{> afQuickField name='docType' value=docType type='hidden'}}
        <button id="submitUpdate" type="submit">{{_ "update"}}</button>
        <button id="cancelUpdate">{{_ "cancel"}}</button>
    {{/autoForm}}
</template>
